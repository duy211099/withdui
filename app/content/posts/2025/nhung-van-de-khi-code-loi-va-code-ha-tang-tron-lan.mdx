---
title: 2. Những vấn đề khi code lõi và code hạ tầng trộn lẫn
slug: nhung-van-de-khi-code-loi-va-code-ha-tang-tron-lan
date: '2025-12-19'
excerpt: ''
category: Web Architecture
tags: ["KIẾN TRÚC ỨNG DỤNG WEB - huynt.dev", "1-Core Code & Infrastructure Code"]
author: huynt.dev
published: true
featured_image: ''
---

Khi code lõi và code hạ tầng không được tách riêng, dự án sẽ gặp phải nhiều vấn đề phức tạp theo thời gian. Dưới đay là một số vấn đề phổ biến:
- Khó nắm bắt logic nghiệp vụ: Khi xem một đoạn code trộn lẫn truy cập CSDL, gọi API, xử lý request http cùng với tính toán nghiệp vụ, rất khó để hiểu câu chuyện nghiệp vụ đang diễn ra là gì. Các chi tiết triển khai kỹ thuật (như truy vấn SQL, thao tác file,...) che mờ ý nghĩa của các bước nghiệp vụ. Ví dụ, trong một hàm xử lý "đặt mua ebook", thay vì thấy rõ các bước như "Lấy giá ebook", "Tính tổng tiền", "Lưu đơn hàng", ta lại thấy một mớ lệnh SQL và xử lý mảng, đòi hỏi người đọc phải "dịch ngược" các đoạn code kỹ thuật để suy ra được ý nghĩa nghiệp vụ của chúng. Code bị "trộn tầng" như vậy làm giảm tính minh bạch của logic ứng dụng
- Phụ thuộc chặt vào công nghệ, khó thay đổi về sau: Khi logic nghiệp vụ gắn chặt với chi tiết hạ tầng, mọi thay đổi công nghệ sẽ ảnh hưởng lan rộng. Chẳng hạn, nếu code xử lý đơn hàng gọi trực tiếp MySQL, việc chuyển sang dùng 1 CDSL NoSQL hoặc thậm chí chỉ thay đổi loại CSDL cũng đòi hỏi chỉnh sửa rất nhiều chỗ trong logic. Tương tự, nếu luồng xử lý gắn việc nhận dữ liệu từ form web, sau này muốn tái sử dụng logic đó cho một API JSON hoặc một giao diện dòng lệnh sẽ gặp nhiều khó khăn. Sự kết hợp chặt chẽ giữa phần lõi và công nghệ bên ngoài làm giảm tính linh hoạt và khả năng mở rộng của hệ thống.
- Khó kiểm thử tự động: Code chứa nhiều phụ thuộc bên ngoài (kết nối DB, gọi 3rd party API, đọc file,...) rất khó để unit test hoặc automation test một cách độc lập. Để chạy được những đoạn code này, môi trường test phải có sẵn DB với bảng dữ liệu, 3rd party phải hoạt động, file phải tồn tại,... dẫn đến việc test trở nên phức tạp, chậm chạp & không ổn định. Ngược lại, nếu tách phần tương tác ngoài ra, code lõi có thể chạy trong cô lập hoàn toàn, không cần DB, không cần tương tác network - giúp viết test dễ dàng và nhanh chóng hơn rất nhiều. Việc trộn lẫn làm chúng ta mất đi khả năng kiểm thử hiệu quả, dẫn đến ngại viết test và hậu quả là ứng dụng thiếu các bộ test bảo vệ
- Không bảo đảm tính nhất quán dữ liệu: Khi logic nghiệp vụ và thao tác dữ liệu nằm rải rác, việc đảm bảo dữ liệu hợp lệ trở nên khó khăn. Ví dụ, nếu mọi nơi trong code trực tiếp chèn dữ liệu vào DBm rất dễ xảy ra trường hợp dữ liệu sai (như email sai định dạng, số lượng âm, tính toán sai tiền) được đưa thằng vào DB mà không qua khâu kiểm tra hợp lệ. Trong một codebase trộn lẫn, không có một lớp đối trượng trung tâm nào chịu trách nhiệm bảo vệ tính nhất quán của dữ liệu domain cả. Điều này dẫn đến nguy cơ lỗi nghiệp vụ cao (ví dụ lưu đơn hàng với email không hợp lệ, số tiền không đúng) mà không phát hiện ra kịp.
- Bảo trì khó khăn và dễ lỗi: Code trộn lẫn thường vi phạm nguyên tác Seperation of Concerns. Mỗi thay đổi nhỏ có thể buộc dev phải chỉnh sửa ở nhiều nơi - ví dụ đổi lược đồ CSDL, phải tìm và sửa mọi câu SQL rải rác trong code nghiệp vụ. Việc này không những mất công mà còn dễ bỏ sót chỗ cần thay, phát sinh lỗi ngầm. Mặt khác, code trộn lẫn thường lặp lại nhiều đoạn tương tự (vì thiếu abstraction), dẫn đến trùng lặp code và tăng khả năng sai sót. Nhìn chung, khi core code và infrastructure code không tách biệt, mã nguồn sẽ "bốc mùi" (code smell): khó đọc, khó hiểu, khó đổi mới, khó kiểm thử. Dự án sẽ dễ rơi vào tình trạng "legacy" sớm, nghĩa là chỉ sau một thời gian ngắn phát triển đã trở nên cồng kềnh, khó cải tiến, mỗi lần sửa đổi hay thêm tính năng đều nơm nớp lo sợ ảnh hưởng dây chuyền.

