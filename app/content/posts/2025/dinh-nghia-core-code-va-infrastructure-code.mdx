---
title: 5. Core code là gì?
slug: dinh-nghia-core-code-va-infrastructure-code
date: '2025-12-22'
excerpt: ''
category: Web Architecture
tags: ["KIẾN TRÚC ỨNG DỤNG WEB - huynt.dev", "2-Định nghĩa Core Code và Infrastructure Code"]
author: huynt.dev
published: true
featured_image: ''
---

Core code của một ứng dụng là phần code có thể chạy được trong bất kỳ context (ngữ cảnh) nào mà không cần bất kỳ hệ thống bên ngoài hay môi trường đặc biệt nào hỗ trọ. Nói cách khác, core code hoàn toàn độc lập với CSDL, network, file system, framework,... Nếu bạn có thể lấy một đoạn code, đưa nó vào một script (JS, PHP,...) độc lập và chạy thành công với bộ nhớ CPU, thì đoạn code đó có khả năng là core code.

Core code được định nghĩa thông qua hai quy tắc quan trọng:
- Quy tắc 1: Không phụ thuộc trực tiếp vào các hệ thống bên ngoài. Core code không được gọi trực tiếp các thành phần bên ngoài ứng dụng, cũng như không phụ thuộc vào code được viết riêng để tương tác với một hệ thống ngoài cụ thể. Hệ thống bên ngoài ở đây bao gồm: CSDL, remote API, hệ thống file, system clock, thư viện gửi mail STMP,... Code lõi phải có khả năng chạy tốt mà không cần những thứ đó. Điều này không có nghĩa core code không được sử dụng abstraction nào: nó có thể gọi các interface, nhưng miễn là interface đó không tiết lộ chi tiết về hệ thống bên ngoài cụ thể. Nếu vi phạm quy tắc này, đoạn code sẽ được xem là infrastructure code.
- Quy tắc 2: Không cần môi trường/ecosystem đặc biệt để chạy. Core code có thể chạy trong mọi bối cảnh, không đòi hỏi chỉ chạy trong web server hay CLI hay framework cụ thể nào. Ví dụ, một class core code không được giả định ràng nó đang chạy trong request web (không được dùng biến global của framework, không dùng HTTP POST trực tiếp, không phụ thuộc session,...) Tương tự, core code cũng không được phụ thuộc các extension hoặc library mà chỉ hoạt động trong môi trường cụ thể. Nếu để chạy hàm đó mà phải có framework (Laravel, .NET, Rails,...) khởi động container, hoặc phải có biến môi trường đặc biệt, thì hàm đó chưa phải core code thuần túy. Nếu một đoạn code tuân thủ cả hai quy tắc trên, ta có thể xem nó là core code. Ngược lại, bất kỳ code nào không thỏa mãn các quy tắc của core code đều được xem là infrastructure code.

# Ví dụ về core code
- Một hàm tính toán thuế VAT từ sản phẩm: nó chỉ nhận input là các con số -> thực hiện phép tính -> trả về kết quả. Hàm này không đọc DB, không gọi API, không phụ thuộc gì ngoài chính input truyền vào: đây là core code điển hình. Bạn có thể gọi hàm này mọi lúc mọi nơi, trong unit test hay trong ứng dụng thực tế đều được, không cần setup gì đặc biệt.
- Một phương thức của đối tượng domain. Nó không truy cập bất kỳ service bên ngoài hay global state nào. Phương thức này có thể chạy độc lập, vì vậy logic bên trong nó thuộc về core code.
- Lớp OrderService với phương thức placeOrder() chẳng hạn, nếu được thiết kế đúng, sẽ lấy vào các giá trị cần thiếtm tạo đối tượng domain, gọi các phương thức xử lý domain (như giảm tồn kho, tính khuyến mãi) và trả về kết quả là một entity hoặc một giá trị nào đó. Nếu trong quá trình đó, OrderService chỉ thac tác trên domain model và sử dụng các interface (như PaymentGatewayInterface, OrderRepositoryInterface) chứ không chạm tới DB hay request, thì OrderService đó cũng có thể được coi là core code (thuộc Application Layer nhưng không chứa code hạ tầng)

Điểm mấu chốt: core code có thể được thực thi hoàn toàn trong bộ nhớ, không đòi hỏi hạ tầng ngoài. Điều này làm cho core code rất dễ kiểm thử: ta có thể tạo đối tượng và gọi phương thức core code mà không cần cấu hình gì phức tạp. Khi cocde tuân thủ quy tác, ta có thể chạy nó cô lập hoàn toàn. Viết automation test cho core code trả nên đơn giản: không cần setup DB, không cần internet, không cần file đặc biệt: chỉ cần bộ nhớ và CPU để chạy code là đủ. Đây chính là lợi thế lớn về testability của core code.

Ngoài ra, core code còn có đặc trưng là di động: bạn có thể tái sử dụng core code trong bối cảnh khác nhau (web app, console app, script nhỏ) mà không gặp trở ngại. Ví dụ, một module tính toán giá vận chuyển (shipping cost) viết thuần túy (core) có thể dùng lại trong nhiều dự án khác nhau chỉ bằng cách import module, vì nó không kéo theo phụ thuộc hạ tầng.